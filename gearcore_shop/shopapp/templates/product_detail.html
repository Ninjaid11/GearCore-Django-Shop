{% extends 'base.html' %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/product_detail.css' %}">
{% endblock %}

{% block content %}
  <div class="product-detail">

    <h1 class="product-title">{{ product.name }}</h1>

    <div class="product-image">
      {% if product.image %}
        <img src="{{ product.image.url }}" alt="{{ product.name }}">
      {% endif %}
    </div>

    <p><strong>Описание:</strong> {{ product.description }}</p>
    <p><strong>Цена:</strong> ${{ product.price }}</p>
    <p><strong>В наличии:</strong> {{ product.in_stock }}</p>
    <p><strong>Бренд:</strong> {{ product.brand }}</p>
    <p><strong>Категория:</strong> {{ product.category }}</p>
    <p><strong>Топ продукт:</strong> {{ product.is_top|yesno:"Да,Нет" }}</p>

    <p><strong>Теги:</strong>
      {% for tag in product.tags.all %}
        <span class="tag">{{ tag.name }}</span>
      {% empty %}
        Нет тегов
      {% endfor %}
    </p>

    <div class="purchase-container">
      <p class="product-price">Цена: ${{ product.price }}</p>
      <form method="post" action="{% url 'add_to_cart' product.id %}" class="buy-form">
        {% csrf_token %}
        <button type="submit" class="btn-buy">Купить</button>
      </form>
    </div>


    <hr>

    <h2>Комментарии</h2>
    {% if comments %}
      <ul class="comments-list">
        {% for comment in comments %}
          <li class="comment-item">
            <strong>{{ comment.user.username }}</strong> — {{ comment.created_at }}
            <p>{{ comment.content }}</p>
          </li>
        {% endfor %}
      </ul>
    {% else %}
      <p>Пока нет комментариев.</p>
    {% endif %}

    <hr>

    {% if user.is_authenticated %}
      <h3>Добавить комментарий</h3>
      <form method="post" class="comment-form">
        {% csrf_token %}
        {{ comment_form.as_p }}
        <button type="submit" class="btn-submit">Отправить</button>
      </form>
    {% else %}
      <p>Чтобы оставить комментарий, <a href="{% url 'account_login' %}">войдите в аккаунт</a>.</p>
    {% endif %}

  </div>
{% endblock %}